<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spinz -Easy win- Slot Machine </title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
  <link rel="stylesheet" href="./style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.2.0/socket.io.js"></script>
</head>
<body>
  <div class="bet-info">
    <div class="bet-amount">
      <h3>Bet: R5</h3>
    </div>
    <div class="balance">
      <h3>Balance: <span id="dynamic-balance">Loading</span></h3>
    </div>
  </div>

  <div id="loading-overlay" class="loading-overlay">
    Loading...
  </div>

  <!-- partial:index.partial.html -->
  <!-- Step-by-step tutorial for this pen at https://youtu.be/boI2B4Gpp34 -->
  <audio id="Sound" loop>
    <source src="./music.mp3" type="audio/mp3">
    Your browser does not support the audio element.
  </audio>

  <button id="playButton">Play Music</button>

  <div class="slots">
    <div class="reel"></div>
    <div class="reel"></div>
    <div class="reel"></div>
  </div>

  <div id="debug" class="debug"></div>

  <img style="position:fixed; left: 0; top: 0; height: 100vh; width: auto;"  src="https://assets.codepen.io/439000/slotreel.webp">

  <!-- partial -->
  <script  src="./script.js"></script>

<script>
  document.getElementById("playButton").addEventListener("click", function() {
    const audio = document.getElementById("Sound");
    audio.play();
  });


  let balance = 0;
  function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
      results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
  }

  function removeParameterFromUrl(parameter) {
    var url = window.location.href;
    var urlparts = url.split('?');

    if (urlparts.length >= 2) {
      var prefix = encodeURIComponent(parameter) + '=';
      var pars = urlparts[1].split(/[&;]/g);

      for (var i = pars.length; i-- > 0;) {
        if (pars[i].lastIndexOf(prefix, 0) !== -1) {
          pars.splice(i, 1);
        }
      }

      url = urlparts[0] + (pars.length > 0 ? '?' + pars.join('&') : '');
      window.history.replaceState({}, document.title, url);
    }
  }

  var token = getParameterByName('token');
  localStorage.setItem("yourTokenKey", token);

  if (token) {
    // Show loading overlay
    showLoadingOverlay();

    // Send request to verify token
    verifyTokenAndFetchBalance(token);
  }

  function showLoadingOverlay() {
      const loadingOverlay = document.getElementById('loading-overlay');
      loadingOverlay.style.display = 'block';
    }

  function hideLoadingOverlay() {
      const loadingOverlay = document.getElementById('loading-overlay');
      loadingOverlay.style.display = 'none';
    }

  async function verifyTokenAndFetchBalance(token) {
    try {
      const response = await fetch('https://spinz-wheel-server-fad3c875d012.herokuapp.com/verify-token', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ token }),
      });

      const data = await response.json();

      if (response.ok) {
         balance=data.userBalance;
        updateBalanceUI(data.userBalance);
      } else {
        console.error('Error verifying token:', data.error);
        // Handle error, e.g., display an error message
      }
    } catch (error) {
      console.error('Error verifying token:', error);
      // Handle network error, e.g., display an error message
    } finally {
      // Hide loading overlay regardless of success or failure
      hideLoadingOverlay();
    }
  }

  function updateBalanceUI(userBalance) {
      const dynamicBalanceElement = document.getElementById('dynamic-balance');
      dynamicBalanceElement.textContent = userBalance;

      
      hideLoadingOverlay();
    }

	
</script>


</body>
</html>
